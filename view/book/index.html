<!DOCTYPE html "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <title>{{ book.title|escape}} - Bunco</title>
    <link rel="stylesheet" href="/public/stylesheet/application.css" />
    <script type="text/javascript" src="/js/jquery.js" ></script>
    <script type="text/javascript">
      $(function() {
        $("#delete-book").submit(function() {
           $.ajax({
             type: "DELETE",
             url: this.action,
             success: function() {
               location.href = "/";
             },
             error: function() {
               alert("エラーです(エラー処理を実装するよう管理者に頼んでください)");
             },
           });
           return false;
        });
        $(".delete-comment").submit(function() {
          var self = this;
           $.ajax({
             type: "DELETE",
             url: this.action,
             success: function() {
               $(self.parentNode.parentNode.parentNode).remove();
             },
             error: function() {
               alert("エラーです(エラー処理を実装するよう管理者に頼んでください)");
             },
           });
           return false;
        });
      });
    </script>
  </head>
  <body>
    {{greeting}}

    <h1>{{ book.title|escape}}</h1>
    <table>
      <tr>
        <td>isbn</td>
        <td>{{ book.isbn|escape}}</td>
      </tr>
      <tr>
        <td>title</td>
        <td>{{ book.title|escape}}</td>
      </tr>
      <tr>
        <td>author</td>
        <td>{{ book.author|escape}}</td>
      </tr>
      <tr>
        <td>publisher</td>
        <td>{{ book.publisher|escape}}</td>
      </tr>
      <tr>
        <td>published_at</td>
        <td>{{ book.published_at|escape}}</td>
      </tr>
      <tr>
        <td>created_at</td>
        <td>{{ book.created_at|escape}}</td>
      </tr>
    </table>
    <h2>Comment</h2>
    <ul>
      {% for comment in book.comments %}
      <li>
        <div class="comment">
          <span class="username">{% if comment.author %}{{ comment.author|escape}}{% else %}anonymous{% endif %}</span>
          <span class="timestamp">{{ comment.created_at|escape}}</span>
          <span class="body">{{ comment.body|escape}}</span>
          {% ifequal user comment.author %}
          <span>
            <form action="{{ comment.path }}" method="POST" class="delete-comment">
              <input type="submit" value="delete">
            </form>
          </span>
          {% endifequal %}
      </li>
      {% endfor %}
    </ul>

    <form action="/comment" method="POST">
      <textarea name="body"></textarea>
      <input type="hidden" name="book" value="{{book.isbn|escape}}" />
      <input type="submit" value="Post" />
    </form>
    <h2>Delete</h2>
    <form action="{{ book.path|escape}}" method="POST" id="delete-book">
      <input type="submit" value="delete this book" />
    </form>
    <a href="/" >index</a>
  </body>
</html>
